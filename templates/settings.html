
{% extends "base.html" %}
{% block content %}
<form class="card" method="post" action="/settings?lang={{ lang }}">
  <div class="grid">
    <div>
      <label>{{ t['market'] }}</label>
      <input name="market" value="{{ cfg.market }}" />
    </div>
    <div>
      <label>Markets (comma separated)</label>
      <input name="markets" value="{{ ', '.join(cfg.markets) if cfg.markets else cfg.market }}" />
    </div>
    <div>
      <label>{{ t['timeframe'] }}</label>
      <select name="timeframe">
        {% for tf in ['1m','5m','15m','1h'] %}
          <option value="{{ tf }}" {% if cfg.timeframe==tf %}selected{% endif %}>{{ tf }}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label>{{ t['max_spread_bps'] }}</label>
      <input type="number" step="1" name="max_spread_bps" value="{{ cfg.max_spread_bps }}"/>
    </div>
  </div>
  <h3>{{ t['strategy'] }}</h3>
  <div>
    <label>Strategy Type</label>
    <select name="strategy_type">
      {% for opt in ['rsi_ema','breakout','vwap','grid'] %}
        <option value="{{ opt }}" {% if cfg.strategy.type==opt %}selected{% endif %}>{{ opt }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="grid">
    <div><label>{{ t['ema_fast'] }}</label><input type="number" name="ema_fast" value="{{ cfg.strategy.ema_fast }}"></div>
    <div><label>{{ t['ema_slow'] }}</label><input type="number" name="ema_slow" value="{{ cfg.strategy.ema_slow }}"></div>
    <div><label>{{ t['rsi_period'] }}</label><input type="number" name="rsi_period" value="{{ cfg.strategy.rsi_period }}"></div>
    <div><label>{{ t['rsi_buy'] }}</label><input type="number" name="rsi_buy" value="{{ cfg.strategy.rsi_buy }}"></div>
    <div><label>{{ t['rsi_sell'] }}</label><input type="number" name="rsi_sell" value="{{ cfg.strategy.rsi_sell }}"></div>
  </div>
  <h3>{{ t['risk'] }}</h3>
  <div class="grid">
    <div><label>{{ t['risk_per_trade'] }}</label><input type="number" step="0.1" name="risk_per_trade_pct" value="{{ cfg.risk.risk_per_trade_pct }}"></div>
    <div><label>{{ t['stop_loss_pct'] }}</label><input type="number" step="0.1" name="stop_loss_pct" value="{{ cfg.risk.stop_loss_pct }}"></div>
    <div><label>{{ t['take_profit_pct'] }}</label><input type="number" step="0.1" name="take_profit_pct" value="{{ cfg.risk.take_profit_pct }}"></div>
  </div>
  <div style="margin-top:12px;display:flex;gap:8px;align-items:center;">
    <button type="submit">{{ t['save'] }}</button>
    <span class="badge">{{ t['save_success'] if saved else '' }}</span>
  </div>
  <div style="margin-top:10px;">
    <strong>{{ t['api_keys'] }}:</strong> <span class="badge">{{ t['note_env'] }}</span>
  </div>
</form>
{% endblock %}

  <h3>Profit Skim</h3>
  <div class="grid">
    <div><label>Enabled</label>
      <select name="skim_enabled">
        <option value="true" {% if cfg.skim.enabled %}selected{% endif %}>True</option>
        <option value="false" {% if not cfg.skim.enabled %}selected{% endif %}>False</option>
      </select>
    </div>
    <div><label>Step (%)</label><input type="number" step="0.1" name="skim_step_pct" value="{{ cfg.skim.step_pct }}"></div>
    <div><label>Fraction per Step (%)</label><input type="number" step="1" name="skim_fraction_pct" value="{{ cfg.skim.fraction_pct }}"></div>
  </div>

  <div class="grid">
    <div><label>Trailing (use High Watermark)</label>
      <select name="skim_trailing">
        <option value="true" {% if cfg.skim.trailing %}selected{% endif %}>True</option>
        <option value="false" {% if not cfg.skim.trailing %}selected{% endif %}>False</option>
      </select>
    </div>
    <div><label>Max Steps</label><input type="number" name="skim_max_steps" value="{{ cfg.skim.max_steps }}"></div>
  </div>

  <h3>Breakout</h3>
  <div class="grid">
    <div><label>Lookback</label><input type="number" name="breakout_lookback" value="{{ cfg.breakout.lookback }}"></div>
    <div><label>Buffer (bps)</label><input type="number" name="breakout_buffer_bps" value="{{ cfg.breakout.buffer_bps }}"></div>
  </div>
  <h3>VWAP</h3>
  <div class="grid">
    <div><label>Window</label><input type="number" name="vwap_window" value="{{ cfg.vwap.window }}"></div>
    <div><label>Band (bps)</label><input type="number" name="vwap_band_bps" value="{{ cfg.vwap.band_bps }}"></div>
  </div>
  <h3>Grid</h3>
  <div class="grid">
    <div><label>Step (%)</label><input type="number" step="0.1" name="grid_step_pct" value="{{ cfg.grid.step_pct }}"></div>
    <div><label>Band Mult</label><input type="number" step="0.1" name="grid_band_mult" value="{{ cfg.grid.band_mult }}"></div>
  </div>
